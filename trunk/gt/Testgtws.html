<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
     <head>     
     <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js"></script>
     <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.5/jquery-ui.min.js"></script>
     <title>Prueba Gotta WS</title>    
     <style>
        body {
            font-family: Verdana, Helvetica, Sans-serif;
            font-size: 10pt;
        }
    
        tr.ejetram {
            display: none;
        }
        
        div#resultadobruto {
            border: 1px dotted #333333;
            margin: 5px;
            padding: 5px;
        }
        
        div#resultadofino {
            border: 1px dotted #333333;
            margin: 5px;
            padding: 5px;
        }
        
        div#resultadofino table {
            border-collapse: collapse;            
        }
        
        div#resultadofino table tr td {
            padding: 4px;            
        }
        
        button {
            width: 36%;
        }
     </style>
     </head>

     <body>
        <h1>Prueba WS Gotta</h1>
        <hr/>
        <table>
            <tr>
                <td>Acci&oacute;n</td>
                <td>
                    <select name="accion" id="acc">
                        <option selected value="nivel">Nivel</option>
                        <option value="ejetram">Tr&aacute;mite</option>
                    </select>
                </td>
            </tr>            
            <tr>
                <td>Usuario</td>
                <td><input type="text" name="usr" value=""/></td>
            </tr>
            <tr>
                <td>Contrase&ntilde;a</td>
                <td><input type="text" name="pwd" value=""/></td>
            </tr>
            <tr>
                <td>Aplicaci&oacute;n</td>
                <td><input type="text" name="app" value=""/></td>
            </tr>
            <tr class="nivel">
                <td>Nivel</td>
                <td><input type="text" name="nivel" value=""/>
            </tr>
            <tr class="ejetram">
                <td>Camino</td>
                <td><input type="text" name="camino" value=""/></td>
            </tr>
            <tr class="ejetram" >
                <td>Tr&aacute;mite</td>
                <td><input type="text" name="tramite" value=""/></td>
            </tr>
            <tr>
                <td>Par&aacute;metros</td>
                <td><textarea id="par" name="params" style="width: 300px"></textarea></td>
            </tr>
            <tr>
                <td colspan="2" style="text-align: center">
                    <button id="envio">Enviar</button>
                    <button id="enviojsonp">Enviar JSONP</button>
                </td>
            </tr>
        </table>
        Resultado en tabla
        <div id="resultadofino"></div>
        Resultado
        <div id="resultadobruto"></div>
     </body>
     
     <script>
        var ant = $('.nivel')
          $('#acc').change(
            function(){
                $('#resultadofino, #resultadobruto').empty()  
                ant.fadeOut()
                ant = $('.'+$(this).val())
                ant.fadeIn()
                }
          )
          
          $('#envio').button().click(
               function()
               {
                    $.post(
                        "./ws",
                         parametros(),
                         function (datos) 
                         {
                            tratadatos(datos)
                         },
                         'json'
                     )
               }
          )
          
          $('#enviojsonp').button().click(
               function()
               {
                     $.getJSON(
                        "http://localhost:8080/v200912/ws?callback=?", /* Modificar para otros dominios */
                         parametros(),
                         function (datos) 
                         {
                            tratadatos(datos)
                         }
                     )
               }
          )
          
          function parametros() 
          {
               var param = {}
               $('input').each(
                    function(){
                         param[$(this).attr('name')] = $(this).val()
                    }
               )               
               param['accion'] = $('#acc').val()
               param['params'] = $('#par').val()
               return param
          }
          
          function tratadatos(datos) {
            $('#resultadofino, #resultadobruto').empty()                         
              var cols = '', filas = ''
              for(x in datos) {
                if(x=='columnas') {
                    for(c in datos[x]) {
                        cols += '<td>' + datos.columnas[c] + '</td>'
                    }                                
                }
                if(x=='filas') {
                    for(f in datos.filas) {
                        filas +='<tr>'
                        for(c in datos.columnas) {
                            filas += '<td>' + datos.filas[f][c] + '</td>'
                        }
                        filas +='</tr>'
                    }
                }
                $('#resultadobruto').append('<div>' + x + ' - ' + datos[x] + '</div>')                                
              }
              if(cols != '' && filas != '') {
                    $('#resultadofino').append('<table border="1"><tr>' + cols + '</tr>' + filas + '</table>')
              }
          }
     </script>
     
</html>